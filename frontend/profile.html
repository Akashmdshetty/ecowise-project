<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üë§ Profile ‚Äî EcoWise</title>
  <meta name="description" content="Your Eco profile ‚Äî points, history, achievements and export / leaderboard.">

  <!-- Icons + font -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#10B981; --primary-600:#059669; --bg:#0F172A; --surface:#1E293B;
      --text:#F8FAFC; --muted:#94A3B8; --glass:rgba(255,255,255,0.06); --glass-border:rgba(255,255,255,0.12);
      --radius:12px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--bg),#0b1724);color:var(--text);-webkit-font-smoothing:antialiased;min-height:100vh}
    .container{max-width:1200px;margin:0 auto;padding:20px}

    /* NAV / HEADER */
    .header{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:14px 0;border-bottom:1px solid var(--glass-border)}
    .brand{display:flex;align-items:center;gap:12px}
    .brand .logo{font-size:22px}
    .brand .title{font-weight:700;font-size:18px}
    .nav-links{display:flex;gap:10px}
    .nav-links a{color:var(--text);text-decoration:none;padding:8px 12px;border-radius:999px;background:transparent}
    .nav-links a.active{background:var(--primary);color:#042117}

    /* layout */
    .profile-grid{display:grid;grid-template-columns:1fr 370px;gap:20px;margin-top:20px}
    @media(max-width:960px){.profile-grid{grid-template-columns:1fr}}
    .card{background:var(--surface);border:1px solid var(--glass-border);border-radius:var(--radius);padding:18px;box-shadow:0 8px 30px rgba(0,0,0,0.25)}
    .profile-card{display:flex;gap:18px;align-items:center}
    .avatar{width:96px;height:96px;border-radius:999px;background:linear-gradient(135deg,var(--primary),#3B82F6);display:flex;align-items:center;justify-content:center;font-size:36px;box-shadow:0 8px 20px rgba(16,185,129,0.18)}
    .profile-meta h2{margin:0 0 6px 0;font-size:20px}
    .badge{display:inline-block;padding:6px 12px;border-radius:999px;background:linear-gradient(90deg,var(--primary),#3B82F6);color:#042117;font-weight:700}
    .profile-actions{display:flex;gap:8px;flex-wrap:wrap}

    /* stats */
    .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:16px}
    @media(max-width:960px){.stats{grid-template-columns:1fr}}
    .stat{display:flex;align-items:center;gap:12px;padding:14px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid var(--glass-border)}
    .stat .value{font-weight:800;font-size:20px}
    .stat .label{color:var(--muted);font-size:13px}

    /* history + achievements columns */
    .history{margin-top:14px}
    .history-list{max-height:420px;overflow:auto;border-radius:12px;border:1px solid var(--glass-border);background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)}
    .history-item{display:flex;align-items:center;justify-content:space-between;padding:12px;border-bottom:1px dashed rgba(255,255,255,0.02)}
    .history-item:last-child{border-bottom:none}
    .history-meta{display:flex;gap:12px;align-items:center}
    .history-icon{width:44px;height:44;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(90deg,var(--primary),#3B82F6);font-size:20px}

    .achievements{margin-top:14px}
    .achievement{display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;border:1px solid var(--glass-border);background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
    .achievement.locked{opacity:0.6}
    .achievement .icon{width:48px;height:48;border-radius:10px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.04)}

    /* controls */
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:10px 14px;border-radius:999px;border:none;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--primary);color:#042117}
    .btn.ghost{background:transparent;border:1px solid var(--glass-border);color:var(--text)}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1200}
    .modal{background:var(--surface);padding:18px;border-radius:12px;max-width:720px;width:94%;box-shadow:0 20px 60px rgba(0,0,0,0.6)}

    /* tiny helpers */
    .muted{color:var(--muted);font-size:13px}
    .loader{width:16px;height:16px;border:2px solid rgba(255,255,255,0.2);border-left-color:white;border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* responsive tweaks */
    @media(max-width:520px){.avatar{width:76px;height:76px;font-size:28px}}
  </style>
</head>
<body>
  <div class="container" role="main">
    <!-- header -->
    <header class="header" role="banner" aria-label="Top navigation">
      <div class="brand" aria-hidden="true">
        <div class="logo">üå±</div>
        <div>
          <div class="title">EcoWise</div>
          <div class="muted" style="font-size:12px">AI Circular Economy</div>
        </div>
      </div>

      <nav class="nav-links" aria-label="Primary">
        <a href="home.html">Home</a>
        <a href="analyze.html">Analyze</a>
        <a href="map.html">Map</a>
        <a href="profile.html" class="active">Profile</a>
      </nav>
    </header>

    <!-- main layout -->
    <section class="profile-grid" aria-label="User profile and activity">
      <!-- left column -->
      <div>
        <!-- profile card -->
        <div class="card profile-card" aria-labelledby="profileName">
          <div class="avatar" aria-hidden="true">üë§</div>
          <div class="profile-meta" style="flex:1">
            <h2 id="profileName">‚Äî</h2>
            <div class="muted" id="memberSince">Member since ‚Äî</div>
            <div style="margin-top:10px" class="profile-actions">
              <button class="btn primary" id="exportBtn" type="button" aria-live="polite"><i class="fas fa-download"></i> Export Data</button>
              <button class="btn ghost" id="leaderboardBtn" type="button"><i class="fas fa-trophy"></i> Leaderboard</button>
              <button class="btn ghost" id="logoutBtn" type="button"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
          </div>
          <div style="text-align:right">
            <div class="badge" id="levelBadge">‚Äî</div>
            <div class="muted" style="margin-top:6px;font-size:13px" id="emailText"></div>
          </div>
        </div>

        <!-- stats -->
        <div class="card" style="margin-top:14px">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <h3 style="margin:0">Your Eco Impact</h3>
            <div class="muted">Keep it up ‚ôªÔ∏è</div>
          </div>

          <div class="stats" style="margin-top:12px">
            <div class="stat" aria-hidden="false">
              <div><i class="fas fa-award" style="font-size:22px"></i></div>
              <div>
                <div class="value" id="statPoints">0</div>
                <div class="label muted">EcoPoints</div>
              </div>
            </div>

            <div class="stat">
              <div><i class="fas fa-box-open" style="font-size:22px"></i></div>
              <div>
                <div class="value" id="statItems">0</div>
                <div class="label muted">Items Recycled</div>
              </div>
            </div>

            <div class="stat">
              <div><i class="fas fa-globe" style="font-size:22px"></i></div>
              <div>
                <div class="value" id="statCarbon">0 kg</div>
                <div class="label muted">Carbon Saved</div>
              </div>
            </div>
          </div>
        </div>

        <!-- recent history -->
        <div class="card history" style="margin-top:14px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h4 style="margin:0">Recent Activity</h4>
            <button class="btn ghost" id="refreshHistoryBtn"><i class="fas fa-sync-alt"></i> Refresh</button>
          </div>

          <div class="history-list" id="historyList" aria-live="polite" aria-busy="false" style="margin-top:12px">
            <!-- filled via JS -->
            <div style="padding:16px" class="muted">Loading history‚Ä¶</div>
          </div>
        </div>
      </div>

      <!-- right column -->
      <aside>
        <div class="card achievements">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h4 style="margin:0">Achievements</h4>
            <div class="muted">Progress</div>
          </div>

          <div style="margin-top:12px;display:grid;gap:10px">
            <div class="achievement unlocked" id="achv-first">
              <div class="icon">üå±</div>
              <div>
                <strong>First Step</strong>
                <div class="muted">Recycle your first item</div>
              </div>
            </div>

            <div class="achievement locked" id="achv-200">
              <div class="icon">üèÜ</div>
              <div>
                <strong>Eco Warrior</strong>
                <div class="muted">Reach 200 EcoPoints</div>
              </div>
            </div>

            <div class="achievement locked" id="achv-50">
              <div class="icon">üåü</div>
              <div>
                <strong>Consistent Saver</strong>
                <div class="muted">Recycle 50 items</div>
              </div>
            </div>

            <div class="achievement locked" id="achv-carbon">
              <div class="icon">üíé</div>
              <div>
                <strong>Carbon Hero</strong>
                <div class="muted">Save 100kg of carbon</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <h4 style="margin:0 0 10px 0">Profile Actions</h4>
          <div style="display:flex;flex-direction:column;gap:8px">
            <button class="btn ghost" id="editProfileBtn"><i class="fas fa-edit"></i> Edit Profile</button>
            <button class="btn ghost" id="deleteAccountBtn" style="color: #ffb4b4"><i class="fas fa-trash-alt"></i> Delete Account</button>
          </div>
        </div>
      </aside>
    </section>
  </div>

  <!-- modal holder -->
  <div id="modalRoot" aria-live="polite"></div>

  <script>
  (function(){
    'use strict';

    // Config
    const API_BASE = window.API_BASE || 'http://localhost:5000';
    const TIMEOUT = 10000; // ms

    // Elements
    const profileName = document.getElementById('profileName');
    const memberSince = document.getElementById('memberSince');
    const levelBadge = document.getElementById('levelBadge');
    const emailText = document.getElementById('emailText');
    const statPoints = document.getElementById('statPoints');
    const statItems = document.getElementById('statItems');
    const statCarbon = document.getElementById('statCarbon');
    const historyList = document.getElementById('historyList');
    const refreshHistoryBtn = document.getElementById('refreshHistoryBtn');
    const exportBtn = document.getElementById('exportBtn');
    const leaderboardBtn = document.getElementById('leaderboardBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const editProfileBtn = document.getElementById('editProfileBtn');
    const deleteAccountBtn = document.getElementById('deleteAccountBtn');
    const modalRoot = document.getElementById('modalRoot');

    // State
    let profile = null;
    let history = [];
    let token = localStorage.getItem('ecowise_token') || null;

    // Utility: fetch with timeout + automatic JSON safe parse
    async function fetchTimeout(url, opts={}, ms=TIMEOUT){
      const controller = new AbortController();
      const id = setTimeout(()=>controller.abort(), ms);
      opts.signal = controller.signal;
      try {
        const res = await fetch(url, opts);
        clearTimeout(id);
        const text = await res.text();
        try { return { ok: res.ok, status: res.status, json: text ? JSON.parse(text) : {} }; }
        catch(e){ return { ok: res.ok, status: res.status, json: { error: 'Invalid JSON from server' } }; }
      } catch (err) {
        clearTimeout(id);
        throw err;
      }
    }

    // Small number animate
    function animateValue(element, start, end, duration=800, suffix=''){
      let startTime = null;
      const step = ts => {
        if (!startTime) startTime = ts;
        const progress = Math.min((ts - startTime) / duration, 1);
        const value = Math.floor(start + (end - start) * progress);
        element.textContent = suffix ? `${value}${suffix}` : value;
        if (progress < 1) requestAnimationFrame(step);
      };
      requestAnimationFrame(step);
    }

    // Safe text (very small sanitization)
    function safe(s){ return String(s == null ? '' : s); }

    // UI updates
    function renderProfileUI(p){
      profileName.textContent = safe(p.username || 'User');
      memberSince.textContent = 'Member since ' + (p.member_since ? new Date(p.member_since).toLocaleDateString() : '‚Äî');
      levelBadge.textContent = safe(p.level || 'Eco Friend');
      emailText.textContent = p.email ? p.email : '';
      animateValue(statPoints, 0, p.eco_points || 0, 800);
      animateValue(statItems, 0, p.items_recycled || 0, 800);
      animateValue(statCarbon, 0, p.carbon_saved_kg || 0, 800, ' kg');

      // achievements
      updateAchievements(p.eco_points || 0, p.items_recycled || 0, p.carbon_saved_kg || 0);
    }

    function renderHistoryList(items){
      historyList.setAttribute('aria-busy','false');
      if (!items || items.length === 0){
        historyList.innerHTML = '<div style="padding:16px" class="muted">No recent activity yet. Start analyzing items to gain EcoPoints!</div>';
        return;
      }
      historyList.innerHTML = items.map(it => {
        const date = it.processed_at ? new Date(it.processed_at).toLocaleString() : '‚Äî';
        return `
          <div class="history-item" role="article" aria-label="${safe(it.filename)}">
            <div class="history-meta">
              <div class="history-icon">üì∏</div>
              <div>
                <div><strong>${safe(it.filename)}</strong></div>
                <div class="muted">${date}</div>
              </div>
            </div>
            <div style="text-align:right">
              <div style="font-weight:800">+${safe(it.points_earned || it.points || 0)} pts</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function updateAchievements(points, items, carbon){
      // simple thresholds
      document.getElementById('achv-first').classList.toggle('unlocked', items > 0);
      document.getElementById('achv-first').classList.toggle('locked', items <= 0);

      document.getElementById('achv-200').classList.toggle('unlocked', points >= 200);
      document.getElementById('achv-200').classList.toggle('locked', points < 200);

      document.getElementById('achv-50').classList.toggle('unlocked', items >= 50);
      document.getElementById('achv-50').classList.toggle('locked', items < 50);

      document.getElementById('achv-carbon').classList.toggle('unlocked', carbon >= 100);
      document.getElementById('achv-carbon').classList.toggle('locked', carbon < 100);
    }

    // Load profile & history from server (with fallback to mock)
    async function loadProfileAndHistory(){
      try {
        const headers = token ? { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' } : { 'Content-Type': 'application/json' };
        // fetch profile
        try {
          const profResp = await fetchTimeout(API_BASE + '/me', { headers });
          if (profResp.ok){
            profile = profResp.json;
          } else {
            // server returned non-ok: fallback to mock
            console.warn('Profile fetch status', profResp.status);
            profile = mockProfile();
          }
        } catch (err) {
          console.warn('Profile fetch failed, using mock', err);
          profile = mockProfile();
        }

        renderProfileUI(profile);

        // fetch history
        historyList.setAttribute('aria-busy','true');
        try {
          const histResp = await fetchTimeout(API_BASE + '/history', { headers });
          if (histResp.ok && Array.isArray(histResp.json)) {
            history = histResp.json;
          } else if (histResp.ok && histResp.json.history) {
            history = histResp.json.history;
          } else {
            history = mockHistory();
          }
        } catch (err) {
          console.warn('History fetch failed, using mock', err);
          history = mockHistory();
        }

        renderHistoryList(history);
      } catch (err) {
        console.error(err);
        // show fallback UI
        profileName.textContent = 'Error loading profile';
        historyList.innerHTML = '<div style="padding:16px" class="muted">Unable to load history at the moment.</div>';
      }
    }

    // Export user data as JSON download
    function exportUserData(){
      const exportBtnEl = exportBtn;
      exportBtnEl.disabled = true;
      const original = exportBtnEl.innerHTML;
      exportBtnEl.innerHTML = '<span class="loader" aria-hidden="true"></span> Exporting...';

      try {
        // Build data. If profile/history are missing, fetch minimal mock
        const data = {
          profile: profile || mockProfile(),
          history: history || mockHistory(),
          exported_at: new Date().toISOString()
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `ecowise_export_${(profile && profile.username) ? profile.username : 'user'}_${Date.now()}.json`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      } catch (err) {
        console.error('Export error', err);
        alert('Export failed. Check console for details.');
      } finally {
        setTimeout(()=>{ exportBtnEl.disabled = false; exportBtnEl.innerHTML = original; }, 800);
      }
    }

    // Leaderboard modal
    function showLeaderboardModal(){
      const modal = document.createElement('div');
      modal.className = 'modal-backdrop';
      modal.innerHTML = `
        <div class="modal" role="dialog" aria-modal="true" aria-label="Leaderboard">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <h3 style="margin:0">üèÜ Eco Leaderboard</h3>
            <button aria-label="Close leaderboard" id="closeLb" class="btn ghost"><i class="fas fa-times"></i></button>
          </div>
          <div id="leaderboardContent">Loading‚Ä¶</div>
        </div>
      `;
      modalRoot.appendChild(modal);
      modal.querySelector('#closeLb').addEventListener('click', ()=> modal.remove());

      // populate content (mock or real)
      Promise.resolve().then(async ()=>{
        try {
          const resp = await fetchTimeout(API_BASE + '/leaderboard', { headers: token ? { 'Authorization': 'Bearer ' + token } : {} }, 8000);
          let list = [];
          if (resp.ok && Array.isArray(resp.json)) list = resp.json;
          else list = mockLeaderboard();
          const html = list.map((u,i)=>`
            <div style="display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;margin-bottom:8px;background:var(--glass);border:1px solid var(--glass-border)">
              <div style="display:flex;gap:12px;align-items:center"><div style="font-weight:800">${i<3 ? ['ü•á','ü•à','ü•â'][i] : i+1 + '.'}</div><div>${safe(u.username)}</div></div>
              <div style="font-weight:800;color:var(--primary)">${safe(u.eco_points)} pts</div>
            </div>
          `).join('');
          modal.querySelector('#leaderboardContent').innerHTML = `<div>${html}</div>`;
        } catch (err){
          modal.querySelector('#leaderboardContent').innerHTML = `<div class="muted">Unable to load leaderboard.</div>`;
        }
      });
    }

    // Logout
    function logout(){
      localStorage.removeItem('ecowise_token');
      // Optionally remove other things
      window.location.href = 'login.html';
    }

    // Edit profile modal (simple inline modal)
    function showEditProfile(){
      const modal = document.createElement('div');
      modal.className = 'modal-backdrop';
      modal.innerHTML = `
        <div class="modal" role="dialog" aria-modal="true" aria-label="Edit profile">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <h3 style="margin:0">Edit Profile</h3>
            <button aria-label="Close" id="closeEdit" class="btn ghost"><i class="fas fa-times"></i></button>
          </div>
          <form id="editForm">
            <div style="display:flex;flex-direction:column;gap:8px">
              <label>Username <input id="editUsername" type="text" value="${safe(profile && profile.username)}" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--glass-border)"></label>
              <label>Email <input id="editEmail" type="email" value="${safe(profile && profile.email)}" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--glass-border)"></label>
              <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
                <button type="button" id="cancelEdit" class="btn ghost">Cancel</button>
                <button type="submit" class="btn primary">Save</button>
              </div>
            </div>
          </form>
        </div>
      `;
      modalRoot.appendChild(modal);
      modal.querySelector('#closeEdit').addEventListener('click', ()=> modal.remove());
      modal.querySelector('#cancelEdit').addEventListener('click', ()=> modal.remove());

      modal.querySelector('#editForm').addEventListener('submit', async (e)=>{
        e.preventDefault();
        const username = modal.querySelector('#editUsername').value.trim();
        const email = modal.querySelector('#editEmail').value.trim();
        // Basic validation
        if (!username) return alert('Username required');
        // send to server (best-effort) or update locally
        try {
          const resp = await fetchTimeout(API_BASE + '/me', {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              ...(token ? { 'Authorization': 'Bearer ' + token } : {})
            },
            body: JSON.stringify({ username, email })
          }, 8000);
          if (resp.ok){
            profile = { ...profile, username, email };
            renderProfileUI(profile);
            modal.remove();
            alert('Profile updated');
          } else {
            // server failure - use local update and notify
            profile = { ...profile, username, email };
            renderProfileUI(profile);
            modal.remove();
            alert('Saved locally (server update failed).');
          }
        } catch (err){
          console.warn(err);
          profile = { ...profile, username, email };
          renderProfileUI(profile);
          modal.remove();
          alert('Saved locally (network error).');
        }
      });
    }

    // Delete account (very deliberate)
    async function handleDeleteAccount(){
      const ok = confirm('This will permanently delete your account and all data. Are you sure?');
      if (!ok) return;
      try {
        const resp = await fetchTimeout(API_BASE + '/me', {
          method: 'DELETE',
          headers: { ...(token ? { 'Authorization': 'Bearer ' + token } : {}) }
        }, 8000);
        if (resp.ok){
          alert('Account deleted.');
          logout();
        } else {
          alert('Unable to delete account. Try again later.');
        }
      } catch (err){
        console.error(err);
        alert('Network error. Try again.');
      }
    }

    // Refresh history
    async function refreshHistory(){
      refreshHistoryBtn.disabled = true;
      refreshHistoryBtn.innerHTML = '<span class="loader" aria-hidden="true"></span> Loading...';
      try {
        const headers = token ? { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' } : { 'Content-Type': 'application/json' };
        const resp = await fetchTimeout(API_BASE + '/history', { headers }, 8000);
        if (resp.ok && Array.isArray(resp.json)) {
          history = resp.json;
        } else if (resp.ok && resp.json.history) {
          history = resp.json.history;
        } else {
          history = mockHistory();
        }
        renderHistoryList(history);
      } catch (err){
        console.warn(err);
        history = mockHistory();
        renderHistoryList(history);
      } finally {
        setTimeout(()=>{ refreshHistoryBtn.disabled = false; refreshHistoryBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh'; }, 500);
      }
    }

    // Mock data for offline/demo
    function mockProfile(){
      return {
        username: 'EcoStudent',
        email: 'student@example.com',
        level: 'Eco Warrior',
        member_since: '2024-01-01T00:00:00Z',
        eco_points: 245,
        items_recycled: 32,
        carbon_saved_kg: 47
      };
    }
    function mockHistory(){
      return [
        { filename: "Plastic Bottle", processed_at: "2024-01-15T10:30:00Z", points_earned: 10 },
        { filename: "Old Books", processed_at: "2024-01-14T14:22:00Z", points_earned: 15 },
        { filename: "Cardboard Box", processed_at: "2024-01-13T09:15:00Z", points_earned: 5 },
        { filename: "Glass Jar", processed_at: "2024-01-12T16:45:00Z", points_earned: 8 },
        { filename: "Aluminum Can", processed_at: "2024-01-11T11:20:00Z", points_earned: 5 }
      ];
    }
    function mockLeaderboard(){
      return [
        { username:'EcoMaster', eco_points:542 },
        { username:'GreenWarrior', eco_points:387 },
        { username:'EcoStudent', eco_points:245 },
        { username:'RecyclePro', eco_points:198 }
      ];
    }

    /* ---- Wire UI events ---- */
    exportBtn.addEventListener('click', exportUserData);
    leaderboardBtn.addEventListener('click', showLeaderboardModal);
    logoutBtn.addEventListener('click', logout);
    editProfileBtn.addEventListener('click', showEditProfile);
    deleteAccountBtn.addEventListener('click', handleDeleteAccount);
    refreshHistoryBtn.addEventListener('click', refreshHistory);

    // load on start
    document.addEventListener('DOMContentLoaded', loadProfileAndHistory);

    // expose small debug object
    window._ecowise = window._ecowise || {};
    window._ecowise.getState = ()=> ({ profile, history, token });

  })();
  </script>
</body>
</html>
